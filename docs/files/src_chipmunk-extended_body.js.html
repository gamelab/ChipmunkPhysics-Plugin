<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\chipmunk-extended\body.js - ChipmunkPhysics</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="ChipmunkPhysics"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.8.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/cp.Body.html">cp.Body</a></li>
            
                <li><a href="../classes/cp.Constraint.html">cp.Constraint</a></li>
            
                <li><a href="../classes/cp.Shape.html">cp.Shape</a></li>
            
                <li><a href="../classes/cp.Space.html">cp.Space</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Body.html">Kiwi.Plugins.ChipmunkPhysics.Body</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Component.html">Kiwi.Plugins.ChipmunkPhysics.Component</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Joints.DampedRotarySpring.html">Kiwi.Plugins.ChipmunkPhysics.Joints.DampedRotarySpring</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Joints.DampedSpring.html">Kiwi.Plugins.ChipmunkPhysics.Joints.DampedSpring</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Joints.Gear.html">Kiwi.Plugins.ChipmunkPhysics.Joints.Gear</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Joints.Groove.html">Kiwi.Plugins.ChipmunkPhysics.Joints.Groove</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Joints.Pin.html">Kiwi.Plugins.ChipmunkPhysics.Joints.Pin</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Joints.Pivot.html">Kiwi.Plugins.ChipmunkPhysics.Joints.Pivot</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Joints.Ratchet.html">Kiwi.Plugins.ChipmunkPhysics.Joints.Ratchet</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Joints.RotaryLimit.html">Kiwi.Plugins.ChipmunkPhysics.Joints.RotaryLimit</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Joints.SimpleMotor.html">Kiwi.Plugins.ChipmunkPhysics.Joints.SimpleMotor</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Joints.Slide.html">Kiwi.Plugins.ChipmunkPhysics.Joints.Slide</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Manager.html">Kiwi.Plugins.ChipmunkPhysics.Manager</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Shapes.Box.html">Kiwi.Plugins.ChipmunkPhysics.Shapes.Box</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Shapes.Box2.html">Kiwi.Plugins.ChipmunkPhysics.Shapes.Box2</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Shapes.Circle.html">Kiwi.Plugins.ChipmunkPhysics.Shapes.Circle</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Shapes.Poly.html">Kiwi.Plugins.ChipmunkPhysics.Shapes.Poly</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Shapes.Segment.html">Kiwi.Plugins.ChipmunkPhysics.Shapes.Segment</a></li>
            
                <li><a href="../classes/Kiwi.Plugins.ChipmunkPhysics.Space.html">Kiwi.Plugins.ChipmunkPhysics.Space</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/ChipmunkPhysics.html">ChipmunkPhysics</a></li>
            
                <li><a href="../modules/cp.html">cp</a></li>
            
                <li><a href="../modules/Joints.html">Joints</a></li>
            
                <li><a href="../modules/Plugins.html">Plugins</a></li>
            
                <li><a href="../modules/Shapes.html">Shapes</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\chipmunk-extended\body.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
*
* @module Plugins
* @submodule ChipmunkPhysics
*
*/

/**
* An extended version of the Chipmunk Body class.
* This object has been designed to function with Kiwi Transform Objects and the transformation hierarchy associated with them.
*
* Nice aliases have also been attached :)
*
* Note: Scale on transforms are not taken into account for an objects shape (hitbox). 
* But position due to scale is taken into account.         
* 
* @namespace Kiwi.Plugins.ChipmunkPhysics
* @class Body
* @extends cp.Body
* @constructor
* @param [params] {Object}
*	@param params.mass {Number} The mass of this body. 
* 	@param params.i {Number} Moment of inertia. Used to resolve collisions.
*   @param [params.transform] {Kiwi.Geom.Transform} The transform that this body will use to position itself by. 
*       If not passed, one is created.
*   @param [params.center] {Object} The location of the bodies centeroid from the transform top left corner. You must either assign both or neither.
* 		@param [params.center.x] {Number} The X location of the centeroid. Defaults to the transforms anchorPointX. 
* 		@param [params.center.y] {Number} The Y location of the centeroid. Defaults to the transforms anchorPointY/
*	@param [params.owner=null] {Any} The owner of this body. Generally assigned to a sprite.
*	@param [params.velocity] {Object} Velocity of the body.
*		@param [params.velocity.x=0] {Number} Velocity of the body on the x-axis.
*		@param [params.velocity.y=0] {Number} Velocity of the body on the y-axis.
*	@param [params.maxVelocity=Infinity] {Number} Maximum velocity of the body. 
*	@param [params.angVelo=0] {Number} Angular velocity of the body.
*	@param [params.maxAngVelo=Infinity] {Number} Maximum angular velocity of the body.
*
*/
Kiwi.Plugins.ChipmunkPhysics.Body = function( params ) {

	params = Kiwi.Plugins.ChipmunkPhysics.Body.parseParams( params );

	/**
	* The transform object that this body will use for positioning.
	* @property transform
	* @type Kiwi.Geom.Transform
	* @public
	*/
	this.transform = params.transform;


	/**
	* The center of the body. From the top left corner of the body.
	* @property center
	* @type Kiwi.Geom.Point
	* @public
	*/ 
	this.center = new Kiwi.Geom.Point( params.center.x, params.center.y );


	/**
	* The owner of this body. Generally is assigned to a GameObject.
	* @property owner
	* @type Any
	* @default null
	* @public
	*/
	this.owner = params.owner;


	cp.Body.call( this, params.mass, params.i );


	if( typeof params.maxVelocity !== &quot;undefined&quot; ) {
		this.maxVelocity = params.maxVelocity;
	}


	if( typeof params.maxAngVelo !== &quot;undefined&quot; ) {
		this.maxAngVelo = params.maxAngVelo;
	}


	if( typeof params.angVelo !== &quot;undefined&quot; ) {
		this.setAngVel( params.angle );
	}


	if( typeof params.velocity !== &quot;undefined&quot; ) {
		this.setVelocity( params.velocity );
	}

};

Kiwi.extend( Kiwi.Plugins.ChipmunkPhysics.Body, cp.Body );


/**
* Used each time a new Body is created to assign default values to the params object passed.
* Returns the same params object passed but with defaults assigned.
* @method _parseParams
* @param [params] {Object}
* @return {Object}
* @static
* @private
*/
Kiwi.Plugins.ChipmunkPhysics.Body.parseParams = function( params ) {

	params = params || {};

	params.transform = params.transform || new Kiwi.Geom.Transform( 0, 0 ); 

	params.center = params.center || { x: params.transform.anchorPointX, y: params.transform.anchorPointY };

	params.owner = params.owner || null;

	if( typeof params.m !== &quot;undefined&quot; ) {
		params.mass = params.m;

	} else if( typeof params.mass == &quot;undefined&quot; ) {
		console.warn(&#x27;No mass passed. Assigning default.&#x27;);
		params.mass = 100; 
	
	}

	if( typeof params.i == &quot;undefined&quot; ) {
		console.warn(&#x27;No moment of inertia passed. Assigning default.&#x27;);
		params.i = 100;
	}

	return params;
};


/**
* Sets the position of transform that this body is attached to. 
* These values are in WORLD coordinates. See the x/y propreties for more information.
* @method setPos
* @param x {Number}
* @param y {Number}
* @public
*/
Kiwi.Plugins.ChipmunkPhysics.Body.prototype.setPos = function( x, y ) {

	this.x = x;
	this.y = y;

};


/**
* The location of the body in the world space on the x-axis. 
* Assigning a value adjusts the transform assigned to position the body at the cooridnates specified.
* @property x
* @type Number
* @public
*/
Object.defineProperty( Kiwi.Plugins.ChipmunkPhysics.Body.prototype, &#x27;x&#x27;, {

	get: function () {
		return this.transform.worldX + this.center.x;
	},

	set: function (val) {
		this.activate();

		if( this.transform.parent ) {
			var parentRot =  Kiwi.Plugins.ChipmunkPhysics.Body.getWorldRotation( this.transform.parent );
			val -= this.x;

			this.transform.x += val * Math.cos( parentRot );
			this.transform.y += val * Math.sin( parentRot * -1 );
		
		} else {
			this.transform.x = val;
		}

		this.p.x = this.x;

	},

	enumerable: true,

	configurable: true

});



/**
* The location of the body in the world space on the y-axis. 
* Assigning a value adjusts the transform assigned to position the body at the cooridnates specified.
* @property y
* @type Number
* @public
*/
Object.defineProperty( Kiwi.Plugins.ChipmunkPhysics.Body.prototype, &#x27;y&#x27;, {

	get: function () {
		return this.transform.worldY + this.center.y;
	},

	set: function ( val ) {
		this.activate();

		if( this.transform.parent ) {
			var parentRot =  Kiwi.Plugins.ChipmunkPhysics.Body.getWorldRotation( this.transform.parent );
			val -= this.y;

			this.transform.x += val * Math.sin( parentRot );
			this.transform.y += val * Math.cos( parentRot );

		} else {
			this.transform.y = val;
		}
		
		this.p.y = this.y;

	},

	enumerable: true,

	configurable: true

});


/**
* Sets the angle (rotation) of the transform attached.
* Value is in worldRotation coordinates.
* @method setAngle
* @param angle {Number}
* @public
*/
Kiwi.Plugins.ChipmunkPhysics.Body.prototype.setAngle = function( angle ) {

	this.activate();

	if( this.transform.parent ) {
		var pRot = Kiwi.Plugins.ChipmunkPhysics.Body.getWorldRotation( this.transform.parent );
	} else {
		var pRot = 0;
	}

	this.transform.rotation = angle - pRot;

};



/**
* The rotation of the body (and thus the transform) in world coordinates.
* @property rotation
* @type Number
* @public
*/
Object.defineProperty( Kiwi.Plugins.ChipmunkPhysics.Body.prototype, &#x27;rotation&#x27;, {

	get: function () {
		return Kiwi.Plugins.ChipmunkPhysics.Body.getWorldRotation( this.transform );
	},

	set: function ( val ) {
		this.setAngle( val );
	},

	enumerable: true,

	configurable: true

});



/**
* Returns the worldRotation of a transformation passed.
* @method getWorldRotation
* @param transform {Kiwi.Geom.Transform}
* @return {Number} The rotation of the transformation.
* @public
* @static
*/
Kiwi.Plugins.ChipmunkPhysics.Body.getWorldRotation = function( trans ) {

	var rot = trans.rotation;

	if( trans.parent ) {
		return rot + Kiwi.Plugins.ChipmunkPhysics.Body.getWorldRotation( trans.parent );
	}

	return rot;
};




/**
* The mass of this body.
* @property mass
* @type Number
* @public
*/
Object.defineProperty( Kiwi.Plugins.ChipmunkPhysics.Body.prototype, &#x27;mass&#x27;, {

	get: function () {
		return this.m;
	},

	set: function (val) {
		this.setMass(val);
	},

	enumerable: true,
	configurable: true

});


/**
* The velocity of this body on the X axis.
* @property velocityX
* @type Number
* @public
*/
Object.defineProperty( Kiwi.Plugins.ChipmunkPhysics.Body.prototype, &#x27;velocityX&#x27;, {

	get: function () {
		return this.vx;
	},

	set: function ( val ) {
		this.activate();
		this.vx = val;
	},

	enumerable: true,
	configurable: true

});



/**
* The velocity of this body on the Y axis.
* @property velocityY
* @type Number
* @public
*/
Object.defineProperty( Kiwi.Plugins.ChipmunkPhysics.Body.prototype, &#x27;velocityY&#x27;, {

	get: function () {
		return this.vy;
	},

	set: function ( val ) {
		this.activate();
		this.vy = val;
	},

	enumerable: true,
	configurable: true

});


/**
* The angular velocity of this body.
* @property angularVelo
* @type Number
* @public
*/
Object.defineProperty( Kiwi.Plugins.ChipmunkPhysics.Body.prototype, &#x27;angularVelo&#x27;, {

	get: function () {
		return this.w;
	},

	set: function ( val ) {
		this.setAngVel( val );
	},

	enumerable: true,
	configurable: true

});


/**
* The maximum velocity of this object.
* @property maxVelocity
* @type Number
* @default Infinity
* @public
*/
Object.defineProperty( Kiwi.Plugins.ChipmunkPhysics.Body.prototype, &#x27;maxVelocity&#x27;, {

	get: function () {
		return this.v_limit;
	},

	set: function ( val ) {
		this.v_limit = val;
	},

	enumerable: true,

	configurable: true

});



/**
* The maximum angular velocity of this object.
* @property maxAngVelo
* @type Number
* @default Infinity
* @public
*/
Object.defineProperty( Kiwi.Plugins.ChipmunkPhysics.Body.prototype, &#x27;maxAngVelo&#x27;, {

	get: function () {
		return this.w_limit;
	},

	set: function ( val ) {
		this.w_limit = val;
	},

	enumerable: true,

	configurable: true

});



/**
* Overriden version of the function which handles adjusting objects position/rotation after collisions. 
* @method position_func
* @param dt {Number}
* @private
*/
Kiwi.Plugins.ChipmunkPhysics.Body.prototype.position_func = function( dt ) {

	var matrix = this.transform.getConcatenatedMatrix(),
		parentRot =  Kiwi.Plugins.ChipmunkPhysics.Body.getWorldRotation( this.transform.parent ),
		ix = matrix.tx - this.transform.anchorPointX + this.center.x,
		iy = matrix.ty - this.transform.anchorPointY + this.center.y;


	//Set the position of the bodies center.
	this.p.x = ix;
	this.p.y = iy;

	this.a = this.transform.rotation + parentRot; 

	//Update the position as per chipmunk norm
	cp.Body.prototype.position_func.call( this, dt );


	//Calculate the changes in position
	ix = this.p.x - ix;
	iy = this.p.y - iy;


	//Update the transformation information...
	this.transform.rotation += this.a - ( this.transform.rotation + parentRot );
	this.transform.x += ix * Math.cos( parentRot ) + iy * Math.sin( parentRot );
	this.transform.y += ix * Math.sin( parentRot * -1 ) + iy * Math.cos( parentRot );

};
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
